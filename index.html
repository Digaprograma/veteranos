<html><head><base href=".">
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f0f0f0;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
    }

    .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
    }

    .tab {
        padding: 10px 20px;
        background: #333;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 5px;
    }

    .tab.active {
        background: #666;
    }

    .content {
        background: white;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
    }

    th, td {
        padding: 10px;
        border: 1px solid #ddd;
        text-align: left;
    }

    th {
        background-color: #f5f5f5;
    }

    .admin-login {
        max-width: 300px;
        margin: 0 auto;
    }

    .form-group {
        margin-bottom: 15px;
    }

    input, button {
        padding: 8px;
        width: 100%;
        margin-top: 5px;
    }

    button {
        background: #4CAF50;
        color: white;
        border: none;
        cursor: pointer;
    }

    button:hover {
        background: #45a049;
    }

    .matches {
        display: grid;
        gap: 20px;
    }

    .match {
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background: white;
        margin-bottom: 10px;
    }

    .match-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        color: #666;
    }

    .match-details {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        gap: 20px;
        align-items: center;
        text-align: center;
    }

    .match input {
        width: 60px;
        text-align: center;
    }

    .cards-input {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 10px;
    }

    .save-button, .reset-button {
        width: auto;
        padding: 5px 15px;
        margin-top: 10px;
    }

    .reset-button {
        background: #dc3545;
        margin-left: 10px;
    }

    .reset-button:hover {
        background: #c82333;
    }

    .round-section {
        margin-bottom: 30px;
    }

    .round-section h4 {
        margin-bottom: 15px;
        padding-bottom: 5px;
        border-bottom: 2px solid #333;
    }

    .save-feedback {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #4CAF50;
        color: white;
        padding: 10px 20px;
        border-radius: 5px;
        display: none;
    }

    .statute-controls {
        display: flex;
        gap: 10px;
    }

    .statute-button {
        padding: 10px 20px;
        background: #4CAF50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    .statute-button:hover {
        background: #45a049;
    }

    .download-button {
        background: #2196F3;
    }

    .download-button:hover {
        background: #1976D2;
    }

    .admin-statute {
        margin: 20px 0;
    }

    .admin-statute textarea {
        width: 100%;
        min-height: 400px;
        margin-bottom: 15px;
        padding: 15px;
        font-family: Arial, sans-serif;
    }

    .admin-statute-controls {
        display: flex;
        gap: 10px;
    }

    .waiting-list-admin {
        margin: 20px 0;
    }

    .waiting-list-table {
        width: 100%;
        margin-top: 15px;
    }

    .waiting-list-controls {
        margin-bottom: 15px;
    }

    .waiting-list-form {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
    }

    .waiting-list-form input {
        flex: 1;
        max-width: 300px;
    }

    .waiting-list-form button {
        width: auto;
    }

    .remove-player-btn {
        background: #dc3545;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 3px;
        cursor: pointer;
    }

    .remove-player-btn:hover {
        background: #c82333;
    }

    .waiting-list-display {
        margin: 20px 0;
    }

    .waiting-list-display table {
        width: 100%;
        border-collapse: collapse;
    }

    .waiting-list-display th,
    .waiting-list-display td {
        padding: 10px;
        border: 1px solid #ddd;
        text-align: left;
    }

    .licenses-admin {
        margin: 20px 0;
    }

    .licenses-form {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        flex-wrap: wrap;
    }

    .licenses-form input,
    .licenses-form select {
        padding: 8px;
        margin: 5px;
    }

    .licenses-table {
        width: 100%;
        margin-top: 15px;
    }

    .remove-license-btn {
        background: #dc3545;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 3px;
        cursor: pointer;
    }

    .remove-license-btn:hover {
        background: #c82333;
    }

    .licenses-display {
        margin: 20px 0;
    }

    .match-teams {
        text-align: center;
        margin-top: 10px;
        font-size: 1.1em;
        font-weight: bold;
    }

    .match-result {
        font-size: 1.2em;
        font-weight: bold;
        margin: 10px 0;
    }

    .match-cards {
        font-size: 0.9em;
        color: #666;
        margin-top: 5px;
    }

    .admin-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        border-bottom: 2px solid #ddd;
        padding-bottom: 10px;
    }

    .admin-tab {
        padding: 8px 16px;
        background: #f5f5f5;
        border: 1px solid #ddd;
        border-radius: 4px;
        cursor: pointer;
    }

    .admin-tab.active {
        background: #4CAF50;
        color: white;
        border-color: #45a049;
    }

    .admin-section {
        display: none;
    }

    .admin-section.active {
        display: block;
    }
    
    .statistics-section {
        margin-bottom: 20px;
    }

    .statistics-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }

    .statistics-table th,
    .statistics-table td {
        padding: 10px;
        border: 1px solid #ddd;
        text-align: left;
    }

    .statistics-table input {
        width: 100%;
        padding: 5px;
        border: 1px solid #ddd;
    }

    .statistics-section input[type="number"] {
        width: 70px;
        padding: 5px;
    }

    .statistics-section input[type="text"] {
        width: 150px;
        padding: 5px;
    }
    
    .team-roster {
        margin: 20px 0;
    }

    .team-roster h3 {
        margin-bottom: 15px;
        padding-bottom: 5px;
        border-bottom: 2px solid #333;
    }

    .roster-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 30px;
    }

    .roster-table th,
    .roster-table td {
        padding: 8px;
        border: 1px solid #ddd;
        position: relative;
    }

    .roster-table input {
        width: 100%;
        padding: 5px;
        border: 1px solid #ddd;
    }

    .roster-table input[type="number"] {
        width: 70px;
    }

    .poll-form {
        margin: 20px 0;
    }

    .poll-form select, 
    .poll-form input {
        padding: 8px;
        margin: 5px;
        width: 200px;
    }

    .poll-results {
        margin-top: 20px;
    }

    .poll-results-table {
        width: 100%;
        border-collapse: collapse;
    }

    .poll-results-table th,
    .poll-results-table td {
        padding: 10px;
        border: 1px solid #ddd;
        text-align: left;
    }

    .poll-controls {
        margin: 15px 0;
        display: flex;
        gap: 10px;
    }

    .poll-button {
        background: #4CAF50;
        color: white;
        border: none;
        padding: 8px 16px;
        cursor: pointer;
        border-radius: 4px;
    }

    .poll-button:hover {
        background: #45a049;
    }

    .poll-login-form {
        max-width: 300px;
        margin: 20px auto;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
    }

    .poll-login-form input {
        margin-bottom: 10px;
    }

    .poll-results-public {
        margin-top: 20px;
    }

    .vote-feedback {
        color: #4CAF50;
        margin: 10px 0;
        display: none;
    }
    
    .most-voted-player {
        background: #f5f5f5;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
        text-align: center;
    }

    .most-voted-player h3 {
        color: #333;
        margin-bottom: 10px;
    }

    .most-voted-player p {
        font-size: 1.2em;
        color: #4CAF50;
        font-weight: bold;
    }

    .password-input {
        width: 80px !important;
        text-align: center;
    }
    
    .statistics-header {
        background: #f5f5f5;
        padding: 10px;
        cursor: pointer;
        border: 1px solid #ddd;
        border-radius: 4px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .statistics-header:hover {
        background: #e9e9e9;
    }

    .statistics-header::after {
        content: '▼';
        transition: transform 0.3s;
    }

    .statistics-header.collapsed::after {
        transform: rotate(-90deg);
    }

    .statistics-content {
        padding: 15px;
        border: 1px solid #ddd;
        border-top: none;
        border-radius: 0 0 4px 4px;
        display: block;
    }

    .statistics-content.collapsed {
        display: none;
    }
</style>
<script>

// Função para salvar dados no GitHub
async function saveDataToGitHub(data) {
    const token = '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'; // Substitua pelo token que você gerou
    const repo = 'Digaprograma/veteranos'; // Substitua pelo seu usuário e nome do repositório
    const path = 'data.json'; // Nome do arquivo JSON
    const url = `https://api.github.com/repos/${repo}/contents/${path}`;

    // Converte os dados para JSON e codifica em Base64
    const content = JSON.stringify(data);
    const encodedContent = btoa(unescape(encodeURIComponent(content)));

    // Verifica se o arquivo já existe para obter o SHA (necessário para atualizar)
    const response = await fetch(url, {
        headers: {
            'Authorization': `token ${token}`,
            'Accept': 'application/vnd.github.v3+json'
        }
    });

    let sha = null;
    if (response.ok) {
        const fileInfo = await response.json();
        sha = fileInfo.sha;
    }

    // Envia os dados para o GitHub
    const updateResponse = await fetch(url, {
        method: 'PUT',
        headers: {
            'Authorization': `token ${token}`,
            'Accept': 'application/vnd.github.v3+json',
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            message: 'Atualizando dados do site',
            content: encodedContent,
            sha: sha // Se o arquivo já existir, use o SHA para atualizá-lo
        })
    });

    if (updateResponse.ok) {
        console.log('Dados salvos com sucesso no GitHub!');
    } else {
        console.error('Erro ao salvar dados no GitHub:', await updateResponse.text());
    }
}

    if (response.ok) {
        const fileInfo = await response.json();
        const content = atob(fileInfo.content); // Decodifica o conteúdo Base64
        return JSON.parse(content); // Converte o conteúdo de volta para JSON
    } else {
        console.error('Erro ao carregar dados do GitHub:', await response.text());
        return null;
    }
}
// Carregar dados ao iniciar o site
window.onload = async function () {
    const data = await loadDataFromGitHub();
    if (data) {
        // Atualize o estado do site com os dados carregados
        standings = data.standings || {};
        waitingList = data.waitingList || [];
        licenses = data.licenses || [];
        // ... e assim por diante
    }

    // Resto do código de inicialização
};

// Salvar dados ao fazer alterações
function updateStandings() {
    // Atualiza a classificação
    // ...

    // Salva os dados no GitHub
    const data = {
        standings,
        waitingList,
        licenses,
        // ... outros dados que você deseja salvar
    };
    saveDataToGitHub(data);
}

let currentTab = 'classification';
const teams = ['Itália', 'Portugal', 'Holanda', 'Espanha'];
let standings = {};
let matches = [];
let players = {};
let votes = new Set();
let isVotingOpen = false;
let statuteContent = '';
let waitingList = [];
let licenses = [];
let currentAdminTab = 'matches';
let topScorers = {
  'Itália': {
    name: '',
    goals: 0
  },
  'Portugal': {
    name: '',
    goals: 0
  },
  'Holanda': {
    name: '',
    goals: 0
  },
  'Espanha': {
    name: '',
    goals: 0
  }
};
let teamRosters = {
  'Itália': Array(20).fill().map(() => ({
    name: '',
    number: '',
    password: '',
    position: ''
  })),
  'Portugal': Array(20).fill().map(() => ({
    name: '',
    number: '',
    password: '',
    position: ''
  })),
  'Holanda': Array(20).fill().map(() => ({
    name: '',
    number: '',
    password: '',
    position: ''
  })),
  'Espanha': Array(20).fill().map(() => ({
    name: '',
    number: '',
    password: '',
    position: ''
  }))
};
let pollVotes = [];
let isVotingEnabled = true;
let hasVoted = new Set();
let playerCards = {
  'Itália': Array(20).fill().map(() => ({
    name: '',
    yellowCards: 0,
    redCards: 0
  })),
  'Portugal': Array(20).fill().map(() => ({
    name: '',
    yellowCards: 0,
    redCards: 0
  })),
  'Holanda': Array(20).fill().map(() => ({
    name: '',
    yellowCards: 0,
    redCards: 0
  })),
  'Espanha': Array(20).fill().map(() => ({
    name: '',
    yellowCards: 0,
    redCards: 0
  }))
};
function initializeTeams() {
  teams.forEach(team => {
    standings[team] = {
      points: 0,
      games: 0,
      wins: 0,
      draws: 0,
      losses: 0,
      redCards: 0,
      yellowCards: 0,
      goalsFor: 0,
      goalsAgainst: 0
    };
    players[team] = Array(20).fill('');
  });
}
function generateMatches() {
  matches = [];
  let currentDate = new Date();
  currentDate.setDate(currentDate.getDate() + (7 - currentDate.getDay()));
  matches.push({
    round: 1,
    team1: "Espanha",
    team2: "Portugal",
    score1: null,
    score2: null,
    yellowCards1: 0,
    yellowCards2: 0,
    redCards1: 0,
    redCards2: 0,
    date: currentDate.toISOString().split('T')[0],
    time: "08:10"
  }, {
    round: 1,
    team1: "Holanda",
    team2: "Itália",
    score1: null,
    score2: null,
    yellowCards1: 0,
    yellowCards2: 0,
    redCards1: 0,
    redCards2: 0,
    date: currentDate.toISOString().split('T')[0],
    time: "09:10"
  });
  currentDate.setDate(currentDate.getDate() + 7);
  matches.push({
    round: 2,
    team1: "Espanha",
    team2: "Itália",
    score1: null,
    score2: null,
    yellowCards1: 0,
    yellowCards2: 0,
    redCards1: 0,
    redCards2: 0,
    date: currentDate.toISOString().split('T')[0],
    time: "08:10"
  }, {
    round: 2,
    team1: "Portugal",
    team2: "Holanda",
    score1: null,
    score2: null,
    yellowCards1: 0,
    yellowCards2: 0,
    redCards1: 0,
    redCards2: 0,
    date: currentDate.toISOString().split('T')[0],
    time: "09:10"
  });
  currentDate.setDate(currentDate.getDate() + 7);
  matches.push({
    round: 3,
    team1: "Espanha",
    team2: "Holanda",
    score1: null,
    score2: null,
    yellowCards1: 0,
    yellowCards2: 0,
    redCards1: 0,
    redCards2: 0,
    date: currentDate.toISOString().split('T')[0],
    time: "08:10"
  }, {
    round: 3,
    team1: "Itália",
    team2: "Portugal",
    score1: null,
    score2: null,
    yellowCards1: 0,
    yellowCards2: 0,
    redCards1: 0,
    redCards2: 0,
    date: currentDate.toISOString().split('T')[0],
    time: "09:10"
  });
  currentDate.setDate(currentDate.getDate() + 7);
  const firstTurnMatches = [...matches];
  firstTurnMatches.forEach(match => {
    currentDate.setDate(currentDate.getDate() + 7);
    matches.push({
      round: match.round + 3,
      team1: match.team2,
      team2: match.team1,
      score1: null,
      score2: null,
      yellowCards1: 0,
      yellowCards2: 0,
      redCards1: 0,
      redCards2: 0,
      date: currentDate.toISOString().split('T')[0],
      time: match.time
    });
  });
}
function showTab(tabName) {
  currentTab = tabName;
  document.querySelectorAll('.tab-content').forEach(content => {
    content.style.display = 'none';
  });
  document.getElementById(tabName).style.display = 'block';
  if (tabName === 'admin') {
    displayAdminMatches();
  }
  if (tabName === 'matches') {
    displayMatches();
  }
  if (tabName === 'waiting-list') {
    displayPublicWaitingList();
  }
  if (tabName === 'licenses') {
    displayPublicLicenses();
  }
  if (tabName === 'poll') {
    displayPublicPoll();
  }
  if (tabName === 'teams') {
    displayPublicTeamRosters();
  }
  if (tabName === 'statistics') {
    updateStatistics();
  }
}
function adminLogin() {
  const password = document.getElementById('admin-password').value;
  if (password === 'Gremio@') {
    document.getElementById('admin-content').style.display = 'block';
    document.getElementById('admin-login-form').style.display = 'none';
    displayAdminMatches();
  } else {
    alert('Senha incorreta!');
  }
}
function displayAdminMatches() {
  const adminContent = document.getElementById('admin-content');
  adminContent.innerHTML = `
            <div class="admin-tabs">
                <button class="admin-tab active" data-tab="matches" onclick="showAdminTab('matches')">Confrontos</button>
                <button class="admin-tab" data-tab="waitinglist" onclick="showAdminTab('waitinglist')">Lista de Espera</button>
                <button class="admin-tab" data-tab="licenses" onclick="showAdminTab('licenses')">Joga. Licenças</button>
                <button class="admin-tab" data-tab="statute" onclick="showAdminTab('statute')">Estatuto</button>
                <button class="admin-tab" data-tab="statistics" onclick="showAdminTab('statistics')">Estatísticas</button>
                <button class="admin-tab" data-tab="poll" onclick="showAdminTab('poll')">Enquete</button>
                <button class="admin-tab" data-tab="teams" onclick="showAdminTab('teams')">Times</button>
            </div>
            <div id="admin-matches" class="admin-section active">
                <h3>Gestão de Confrontos</h3>
                <div>

                                 <button class="reset-button" onclick="resetChampionship()">Reiniciar Campeonato</button>
                </div>
                <div class="waiting-list-admin">
                    <h3>Lista de Espera</h3>
                    <div class="waiting-list-controls">
                        <div class="waiting-list-form">
                            <input type="text" id="new-player-name" placeholder="Nome do atleta">
                            <button onclick="addToWaitingList()">Adicionar Atleta</button>
                        </div>
                    </div>
                    <table class="waiting-list-table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="waiting-list-tbody">
                            ${waitingList.map((player, index) => `
                                <tr>
                                    <td>${player}</td>
                                    <td>
                                        <button class="remove-player-btn" onclick="removeFromWaitingList(${index})">Remover</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                <div class="licenses-admin">
                    <h3>Licenças</h3>
                    <div class="licenses-form">
                      <input type="text" id="license-player-name" placeholder="Nome do atleta">
                      <select id="license-team">
                        ${teams.map(team => `<option value="${team}">${team}</option>`).join('')}
                      </select>
                      <input type="date" id="license-start-date">
                      <input type="date" id="license-end-date">
                      <button onclick="addLicense()">Adicionar Licença</button>
                    </div>
                    <table class="licenses-table">
                      <thead>
                        <tr>
                          <th>Nome</th>
                          <th>Time</th>
                          <th>Início</th>
                          <th>Fim</th>
                          <th>Ações</th>
                        </tr>
                      </thead>
                      <tbody id="licenses-tbody">
                        ${licenses.map((license, index) => `
                          <tr>
                            <td>${license.name}</td>
                            <td>${license.team}</td>
                            <td>${license.startDate}</td>
                            <td>${license.endDate}</td>
                            <td>
                              <button class="remove-license-btn" onclick="removeLicense(${index})">Remover</button>
                            </td>
                          </tr>
                        `).join('')}
                      </tbody>
                    </table>
                </div>
                <div class="admin-statute">
                    <h3>Gestão do Estatuto</h3>
                    <textarea id="admin-statute-text" placeholder="Digite o estatuto aqui...">${statuteContent}</textarea>
                    <div class="admin-statute-controls">
                        <button class="statute-button" onclick="saveAdminStatute()">Salvar Estatuto</button>
                        <button class="statute-button download-button" onclick="downloadAdminStatute()">Baixar PDF</button>
                    </div>
                </div>
                <div class="matches-admin">
                    <h3>Confrontos</h3>
                    <div class="matches-controls">
                        <div class="matches-form">
                            
                        </div>
                    </div>
                    <div class="matches-table">
                        <div id="matches-container">
                            
                        </div>
                    </div>
                </div>
            </div>
            <div id="admin-waitinglist" class="admin-section">
                <div class="waiting-list-admin">
                    <h3>Lista de Espera</h3>
                    <div class="waiting-list-controls">
                        <div class="waiting-list-form">
                            <input type="text" id="new-player-name-wl" placeholder="Nome do atleta">
                            <button onclick="addToWaitingList()">Adicionar Atleta</button>
                        </div>
                    </div>
                    <table class="waiting-list-table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="waiting-list-tbody-wl">
                            ${waitingList.map((player, index) => `
                                <tr>
                                    <td>${player}</td>
                                    <td>
                                        <button class="remove-player-btn" onclick="removeFromWaitingList(${index})">Remover</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
            <div id="admin-licenses" class="admin-section">
                <div class="licenses-admin">
                    <h3>Licenças</h3>
                    <div class="licenses-form">
                      <input type="text" id="license-player-name-l" placeholder="Nome do atleta">
                      <select id="license-team-l">
                        ${teams.map(team => `<option value="${team}">${team}</option>`).join('')}
                      </select>
                      <input type="date" id="license-start-date-l">
                      <input type="date" id="license-end-date-l">
                      <button onclick="addLicense()">Adicionar Licença</button>
                    </div>
                    <table class="licenses-table">
                      <thead>
                        <tr>
                          <th>Nome</th>
                          <th>Time</th>
                          <th>Início</th>
                          <th>Fim</th>
                          <th>Ações</th>
                        </tr>
                      </thead>
                      <tbody id="licenses-tbody-l">
                        ${licenses.map((license, index) => `
                          <tr>
                            <td>${license.name}</td>
                            <td>${license.team}</td>
                            <td>${license.startDate}</td>
                            <td>${license.endDate}</td>
                            <td>
                              <button class="remove-license-btn" onclick="removeLicense(${index})">Remover</button>
                            </td>
                          </tr>
                        `).join('')}
                      </tbody>
                    </table>
                </div>
            </div>
            <div id="admin-statute" class="admin-section">
                <div class="admin-statute">
                    <h3>Gestão do Estatuto</h3>
                    <textarea id="admin-statute-text-s" placeholder="Digite o estatuto aqui...">${statuteContent}</textarea>
                    <div class="admin-statute-controls">
                        <button class="statute-button" onclick="saveAdminStatute()">Salvar Estatuto</button>
                        <button class="statute-button download-button" onclick="downloadAdminStatute()">Baixar PDF</button>
                    </div>
                </div>
            </div>
        `;
  const matchesByRound = {};
  matches.forEach(match => {
    if (!matchesByRound[match.round]) {
      matchesByRound[match.round] = [];
    }
    matchesByRound[match.round].push(match);
  });
  Object.keys(matchesByRound).forEach(round => {
    const roundDiv = document.createElement('div');
    roundDiv.className = 'round-section';
    roundDiv.innerHTML = `<h4>Rodada ${round}</h4>`;
    matchesByRound[round].forEach((match, index) => {
      const matchDiv = document.createElement('div');
      matchDiv.className = 'match';
      matchDiv.innerHTML = `
                        <div class="match-header">
                            <input type="date" value="${match.date}" onchange="updateMatchDate(${matches.indexOf(match)}, this.value)">
                            <input type="time" value="${match.time}" onchange="updateMatchTime(${matches.indexOf(match)}, this.value)">
                        </div>
                        <div class="match-details">
                            <div>
                                ${match.team1}
                                <input type="number" min="0" value="${match.score1 || ''}" onchange="updateScore(${matches.indexOf(match)}, 'score1', this.value)">
                                <div class="cards-input">
                                    <div>
                                        CA: <input type="number" min="0" value="${match.yellowCards1}" onchange="updateCards(${matches.indexOf(match)}, 'yellowCards1', this.value)">
                                    </div>
                                    <div>
                                        CV: <input type="number" min="0" value="${match.redCards1}" onchange="updateCards(${matches.indexOf(match)}, 'redCards1', this.value)">
                                    </div>
                                </div>
                            </div>
                            <div>vs</div>
                            <div>
                                ${match.team2}
                                <input type="number" min="0" value="${match.score2 || ''}" onchange="updateScore(${matches.indexOf(match)}, 'score2', this.value)">
                                <div class="cards-input">
                                    <div>
                                        CA: <input type="number" min="0" value="${match.yellowCards2}" onchange="updateCards(${matches.indexOf(match)}, 'yellowCards2', this.value)">
                                    </div>
                                    <div>
                                        CV: <input type="number" min="0" value="${match.redCards2}" onchange="updateCards(${matches.indexOf(match)}, 'redCards2', this.value)">
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
      roundDiv.appendChild(matchDiv);
    });
    document.getElementById('admin-matches').appendChild(roundDiv);
  });
}
function updateMatchDate(index, date) {
  matches[index].date = date;
  localStorage.setItem('matches', JSON.stringify(matches));
  updateStandings();
}
function updateMatchTime(index, time) {
  matches[index].time = time;
  localStorage.setItem('matches', JSON.stringify(matches));
  updateStandings();
}
function updateScore(index, field, value) {
  matches[index][field] = value === '' ? null : parseInt(value);
  localStorage.setItem('matches', JSON.stringify(matches));
  updateStandings();
  showSaveFeedback();
}
function updateCards(index, field, value) {
  matches[index][field] = parseInt(value) || 0;
  localStorage.setItem('matches', JSON.stringify(matches));
  updateStandings();
  showSaveFeedback();
}
function updateStandings() {
  initializeTeams();
  matches.forEach(match => {
    if (match.score1 !== null && match.score2 !== null) {
      const team1 = match.team1;
      const team2 = match.team2;
      standings[team1].games++;
      standings[team2].games++;
      standings[team1].yellowCards += match.yellowCards1;
      standings[team1].redCards += match.redCards1;
      standings[team2].yellowCards += match.yellowCards2;
      standings[team2].redCards += match.redCards2;
      standings[team1].goalsFor += match.score1;
      standings[team1].goalsAgainst += match.score2;
      standings[team2].goalsFor += match.score2;
      standings[team2].goalsAgainst += match.score1;
      if (match.score1 > match.score2) {
        standings[team1].points += 2;
        standings[team1].wins++;
        standings[team2].losses++;
      } else if (match.score2 > match.score1) {
        standings[team2].points += 2;
        standings[team2].wins++;
        standings[team1].losses++;
      } else if (match.score1 === match.score2) {
        standings[team1].points += 1;
        standings[team2].points += 1;
        standings[team1].draws++;
        standings[team2].draws++;
      }
    }
  });
  displayStandings();
}
function displayStandings() {
  const table = document.getElementById('standings-table');
  table.innerHTML = `
            <tr>
                <th>Time</th>
                <th>Pontos</th>
                <th>Jogos</th>
                <th>Vitórias</th>
                <th>Empates</th>
                <th>Derrotas</th>
                <th>CA</th>
                <th>CV</th>
            </tr>
        `;
  Object.entries(standings).sort(([, a], [, b]) => b.points - a.points).forEach(([team, stats]) => {
    table.innerHTML += `
                <tr>
                    <td>${team}</td>
                    <td>${stats.points}</td>
                    <td>${stats.games}</td>
                    <td>${stats.wins}</td>
                    <td>${stats.draws}</td>
                    <td>${stats.losses}</td>
                    <td>${stats.yellowCards}</td>
                    <td>${stats.redCards}</td>
                </tr>
            `;
  });
}
function showSaveFeedback() {
  const feedback = document.createElement('div');
  feedback.className = 'save-feedback';
  feedback.textContent = 'Alterações salvas!';
  document.body.appendChild(feedback);
  feedback.style.display = 'block';
  setTimeout(() => {
    feedback.style.display = 'none';
    feedback.remove();
  }, 2000);
}
function resetChampionship() {
  if (confirm('Tem certeza que deseja reiniciar o campeonato? Todos os resultados serão apagados.')) {
    initializeTeams();
    generateMatches();
    updateStandings();
    displayAdminMatches();
    localStorage.removeItem('matches');
    showSaveFeedback();
  }
}
function displayMatches() {
  const matchesDiv = document.querySelector('#matches .matches');
  const matchesByRound = {};
  matches.forEach(match => {
    if (!matchesByRound[match.round]) {
      matchesByRound[match.round] = [];
    }
    matchesByRound[match.round].push(match);
  });
  let html = '';
  Object.keys(matchesByRound).forEach(round => {
    html += `<div class="round-section">
              <h4>Rodada ${round}</h4>`;
    matchesByRound[round].forEach(match => {
      html += `<div class="match">
                  <div class="match-header">
                    <span>Data: ${match.date}</span>
                    <span>Horário: ${match.time}</span>
                  </div>
                  <div class="match-teams">
                    ${match.team1} vs ${match.team2}
                  </div>
                  ${match.score1 !== null && match.score2 !== null ? `
                    <div class="match-result">
                      Resultado: ${match.score1} - ${match.score2}
                    </div>
                    <div class="match-cards">
                      Cartões ${match.team1}: ${match.yellowCards1} ${match.redCards1}<br>
                      Cartões ${match.team2}: ${match.yellowCards2} ${match.redCards2}
                    </div>
                  ` : `<div class="match-result">Partida não realizada</div>`}
                </div>`;
    });
    html += '</div>';
  });
  matchesDiv.innerHTML = html;
  if (currentTab === 'statistics') {
    updateStatistics();
  }
}
function saveStatute() {
  showSaveFeedback();
}
function saveAdminStatute() {
  const statuteText = document.getElementById('admin-statute-text').value;
  statuteContent = statuteText;
  document.getElementById('statute-text').value = statuteText;
  document.getElementById('statute-display').innerHTML = statuteText.replace(/\n/g, '<br>');
  localStorage.setItem('statuteContent', statuteContent);
  showSaveFeedback();
}
function downloadAdminStatute() {
  if (!statuteContent) {
    alert('Por favor, adicione conteúdo ao estatuto antes de baixar.');
    return;
  }
  const element = document.createElement('div');
  element.innerHTML = `
            <h1>VETERANOS GRÊMIO MINEIRO</h1>
            <h2>Estatuto</h2>
            <div style="white-space: pre-wrap;">${statuteContent}</div>
        `;
  const opt = {
    margin: 1,
    filename: 'estatuto-veteranos-gremio-mineiro.pdf',
    image: {
      type: 'jpeg',
      quality: 0.98
    },
    html2canvas: {
      scale: 2
    },
    jsPDF: {
      unit: 'in',
      format: 'letter',
      orientation: 'portrait'
    }
  };
  html2pdf().from(element).set(opt).save();
}
function downloadStatute() {
  if (!statuteContent) {
    alert('Por favor, adicione conteúdo ao estatuto antes de baixar.');
    return;
  }
  const element = document.createElement('div');
  element.innerHTML = `
            <h1>VETERANOS GRÊMIO MINEIRO</h1>
            <h2>Estatuto</h2>
            <div style="white-space: pre-wrap;">${statuteContent}</div>
        `;
  const opt = {
    margin: 1,
    filename: 'estatuto-veteranos-gremio-mineiro.pdf',
    image: {
      type: 'jpeg',
      quality: 0.98
    },
    html2canvas: {
      scale: 2
    },
    jsPDF: {
      unit: 'in',
      format: 'letter',
      orientation: 'portrait'
    }
  };
  html2pdf().from(element).set(opt).save();
}
function addToWaitingList() {
  let nameInput;
  if (currentAdminTab === 'waitinglist') {
    nameInput = document.getElementById('new-player-name-wl');
  } else {
    nameInput = document.getElementById('new-player-name');
  }
  const name = nameInput.value.trim();
  if (name) {
    waitingList.push(name);
    nameInput.value = '';
    updateWaitingListTable();
    displayPublicWaitingList();
    localStorage.setItem('waitingList', JSON.stringify(waitingList));
    showSaveFeedback();
  }
}
function removeFromWaitingList(index) {
  waitingList.splice(index, 1);
  updateWaitingListTable();
  displayPublicWaitingList();
  localStorage.setItem('waitingList', JSON.stringify(waitingList));
  showSaveFeedback();
}
function updateWaitingListTable() {
  const mainTbody = document.getElementById('waiting-list-tbody');
  const wlTbody = document.getElementById('waiting-list-tbody-wl');
  const tableContent = waitingList.map((player, index) => `
    <tr>
      <td>${player}</td>
      <td>
        <button class="remove-player-btn" onclick="removeFromWaitingList(${index})">Remover</button>
      </td>
    </tr>
  `).join('');
  if (mainTbody) {
    mainTbody.innerHTML = tableContent;
  }
  if (wlTbody) {
    wlTbody.innerHTML = tableContent;
  }
  if (currentTab === 'waiting-list') {
    displayPublicWaitingList();
  }
}
function displayPublicWaitingList() {
  const waitingListDiv = document.getElementById('waiting-list');
  const table = document.createElement('table');
  table.className = 'waiting-list-display';
  table.innerHTML = `
            <thead>
                <tr>
                    <th>Nome do Atleta</th>
                </tr>
            </thead>
            <tbody>
                ${waitingList.map(player => `
                    <tr>
                        <td>${player}</td>
                    </tr>
                `).join('')}
            </tbody>
        `;
  const header = waitingListDiv.querySelector('h2');
  waitingListDiv.innerHTML = '';
  waitingListDiv.appendChild(header);
  waitingListDiv.appendChild(table);
}
function addLicense() {
  let nameInput, teamSelect, startDateInput, endDateInput;
  
  if (currentAdminTab === 'licenses') {
    nameInput = document.getElementById('license-player-name-l');
    teamSelect = document.getElementById('license-team-l'); 
    startDateInput = document.getElementById('license-start-date-l');
    endDateInput = document.getElementById('license-end-date-l');
  } else {
    nameInput = document.getElementById('license-player-name');
    teamSelect = document.getElementById('license-team');
    startDateInput = document.getElementById('license-start-date');
    endDateInput = document.getElementById('license-end-date');
  }

  const name = nameInput.value.trim();
  const team = teamSelect.value;
  const startDate = startDateInput.value;
  const endDate = endDateInput.value;

  if (name && startDate && endDate) {
    licenses.push({
      name,
      team,
      startDate,
      endDate
    });

    // Clear inputs
    nameInput.value = '';
    startDateInput.value = '';
    endDateInput.value = '';

    // Update displays
    updateLicensesTable();
    displayPublicLicenses();
    
    // Save to localStorage
    localStorage.setItem('licenses', JSON.stringify(licenses));
    showSaveFeedback();
  } else {
    alert('Por favor, preencha todos os campos obrigatórios');
  }
}
function removeLicense(index) {
  licenses.splice(index, 1);
  updateLicensesTable();
  showSaveFeedback();
  localStorage.setItem('licenses', JSON.stringify(licenses));
  displayPublicLicenses();
}
function updateLicensesTable() {
  const mainTbody = document.getElementById('licenses-tbody');
  const licenseTbody = document.getElementById('licenses-tbody-l');
  
  const tableContent = licenses.map((license, index) => `
    <tr>
      <td>${license.name}</td>
      <td>${license.team}</td>
      <td>${license.startDate}</td>
      <td>${license.endDate}</td>
      <td>
        <button class="remove-license-btn" onclick="removeLicense(${index})">Remover</button>
      </td>
    </tr>
  `).join('');

  if (mainTbody) {
    mainTbody.innerHTML = tableContent;
  }
  if (licenseTbody) {
    licenseTbody.innerHTML = tableContent;
  }
}
function displayPublicLicenses() {
  const tbody = document.getElementById('public-licenses-tbody');
  if (tbody) {
    tbody.innerHTML = licenses.map(license => `
                <tr>
                    <td>${license.name}</td>
                    <td>${license.team}</td>
                    <td>${license.startDate}</td>
                    <td>${license.endDate}</td>
                </tr>
            `).join('');
  }
}
function showAdminTab(tabName) {
  currentAdminTab = tabName;
  document.querySelectorAll('.admin-tab').forEach(tab => {
    tab.classList.toggle('active', tab.dataset.tab === tabName);
  });
  document.querySelectorAll('.admin-section').forEach(section => {
    section.classList.toggle('active', section.id === `admin-${tabName}`);
  });
  const adminContent = document.getElementById('admin-content');
  adminContent.innerHTML += `
            <div id="admin-statistics" class="admin-section">
                <h3>Desempenho/Probabilidade</h3>
                <div class="statistics-admin">
                    <!-- Statistics content will go here -->
                </div>
            </div>

            <div id="admin-poll" class="admin-section">
                <h3>Enquete</h3>
                <div class="poll-admin">
                    <!-- Poll content will go here -->
                </div>
            </div>

            <div id="admin-teams" class="admin-section">
                <h3>Times</h3>
                <div class="teams-admin">
                    <!-- Teams content will go here -->
                </div>
            </div>
        `;
  if (tabName === 'statistics') {
    updateStatistics();
  }
  if (tabName === 'poll') {
    displayPollAdmin();
  }
  if (tabName === 'teams') {
    displayTeamRosters();
  }
  if (tabName === 'waitinglist') {
    const waitinglistDiv = document.getElementById('admin-waitinglist');
    waitinglistDiv.innerHTML = `
      <h3>Lista de Espera</h3>
      <div class="waiting-list-controls">
        <div class="waiting-list-form">
          <input type="text" id="new-player-name-wl" placeholder="Nome do atleta">
          <button onclick="addToWaitingList()">Adicionar Atleta</button>
        </div>
      </div>
      <table class="waiting-list-table">
        <thead>
          <tr>
            <th>Nome</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody id="waiting-list-tbody-wl">
          ${waitingList.map((player, index) => `
            <tr>
              <td>${player}</td>
              <td>
                <button class="remove-player-btn" onclick="removeFromWaitingList(${index})">Remover</button>
              </td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    `;
  }
  if (tabName === 'licenses') {
    const licensesDiv = document.getElementById('admin-licenses');
    licensesDiv.innerHTML = `
      <h3>Joga. Licenças</h3>
      <div class="licenses-form">
        <input type="text" id="license-player-name-l" placeholder="Nome do atleta">
        <select id="license-team-l">
          ${teams.map(team => `<option value="${team}">${team}</option>`).join('')}
        </select>
        <input type="date" id="license-start-date-l">
        <input type="date" id="license-end-date-l">
        <button onclick="addLicense()">Adicionar Licença</button>
      </div>
      <table class="licenses-table">
        <thead>
          <tr>
            <th>Nome</th>
            <th>Time</th>
            <th>Início</th>
            <th>Fim</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody id="licenses-tbody-l">
          ${licenses.map((license, index) => `
            <tr>
              <td>${license.name}</td>
              <td>${license.team}</td>
              <td>${license.startDate}</td>
              <td>${license.endDate}</td>
              <td>
                <button class="remove-license-btn" onclick="removeLicense(${index})">Remover</button>
              </td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    `;
  }
}
function calculateChampionshipProbability() {
  const totalGames = 12;
  const gamesPlayed = matches.filter(m => m.score1 !== null && m.score2 !== null).length;
  const remainingGames = totalGames - gamesPlayed;
  let probabilities = {};
  let totalPoints = 0;
  Object.entries(standings).forEach(([team, stats]) => {
    const currentPoints = stats.points;
    const maxPossiblePoints = currentPoints + remainingGames * 2;
    const probability = currentPoints / (gamesPlayed * 2) * 100;
    probabilities[team] = Math.min(Math.round(probability), 100);
    totalPoints += probability;
  });
  Object.keys(probabilities).forEach(team => {
    probabilities[team] = Math.round(probabilities[team] / totalPoints * 100);
  });
  return probabilities;
}
function updateStatistics() {
  const statisticsDiv = document.querySelector('#admin-statistics .statistics-admin');
  const probabilities = calculateChampionshipProbability();
  let html = `
    <div class="statistics-section">
      <div class="statistics-header" onclick="toggleSection(this)">
        Probabilidade de Título
      </div>
      <div class="statistics-content">
        <table class="statistics-table">
          <thead>
            <tr>
              <th>Time</th>
              <th>Probabilidade</th>
            </tr>
          </thead>
          <tbody>
            ${Object.entries(probabilities).sort(([, a], [, b]) => b - a).map(([team, probability]) => `
                <tr>
                  <td>${team}</td>
                  <td>${probability}%</td>
                </tr>
              `).join('')}
          </tbody>
        </table>
      </div>
    </div>

    <div class="statistics-section">
      <div class="statistics-header" onclick="toggleSection(this)">
        Artilheiros por Time
      </div>
      <div class="statistics-content">
        <table class="statistics-table">
          <thead>
            <tr>
              <th>Time</th>
              <th>Jogador</th>
              <th>Gols</th>
            </tr>
          </thead>
          <tbody>
            ${Object.entries(topScorers).map(([team, scorer]) => `
              <tr>
                <td>${team}</td>
                <td>
                  <input type="text" 
                         value="${scorer.name}" 
                         onchange="updateTopScorer('${team}', 'name', this.value)">
                </td>
                <td>
                  <input type="number" 
                         min="0" 
                         value="${scorer.goals}"
                         onchange="updateTopScorer('${team}', 'goals', this.value)">
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      </div>
    </div>

    <div class="statistics-section">
      <div class="statistics-header" onclick="toggleSection(this)">
        Cartões por Jogador
      </div>
      <div class="statistics-content">
        <table class="statistics-table">
          <thead>
            <tr>
              <th>Time</th>
              <th>Jogador</th>
              <th>Cartões Amarelos</th>
              <th>Cartões Vermelhos</th>
            </tr>
          </thead>
          <tbody>
            ${Object.entries(playerCards).map(([team, players]) => players.map((player, index) => `
                <tr>
                  <td>${team}</td>
                  <td>
                    <input type="text" 
                           value="${player.name}"
                           onchange="updatePlayerCards('${team}', ${index}, 'name', this.value)">
                  </td>
                  <td>
                    <input type="number"
                           min="0"
                           value="${player.yellowCards}"
                           onchange="updatePlayerCards('${team}', ${index}, 'yellowCards', this.value)">
                  </td>
                  <td>
                    <input type="number"
                           min="0" 
                           value="${player.redCards}"
                           onchange="updatePlayerCards('${team}', ${index}, 'redCards', this.value)">
                  </td>
                </tr>
              `).join('')).join('')}
          </tbody>
        </table>
      </div>
    </div>
  `;
  statisticsDiv.innerHTML = html;
  const statisticsTabDiv = document.getElementById('statistics');
  if (statisticsTabDiv) {
    statisticsTabDiv.innerHTML = `
      <h2>Desempenho/Probabilidade</h2>
      <div class="statistics-section">
        <div class="statistics-header" onclick="toggleSection(this)">
          Probabilidade de Título
        </div>
        <div class="statistics-content">
          <table class="statistics-table">
            <thead>
              <tr>
                <th>Time</th>
                <th>Probabilidade</th>
              </tr>
            </thead>
            <tbody>
              ${Object.entries(probabilities).sort(([, a], [, b]) => b - a).map(([team, probability]) => `
                  <tr>
                    <td>${team}</td>
                    <td>${probability}%</td>
                  </tr>
                `).join('')}
            </tbody>
          </table>
        </div>
      </div>

      <div class="statistics-section">
        <div class="statistics-header" onclick="toggleSection(this)">
          Artilheiros por Time
        </div>
        <div class="statistics-content">
          <table class="statistics-table">
            <thead>
              <tr>
                <th>Time</th>
                <th>Jogador</th>
                <th>Gols</th>
              </tr>
            </thead>
            <tbody>
              ${Object.entries(topScorers).map(([team, scorer]) => `
                  <tr>
                    <td>${team}</td>
                    <td>${scorer.name}</td>
                    <td>${scorer.goals}</td>
                  </tr>
                `).join('')}
            </tbody>
          </table>
        </div>
      </div>

      <div class="statistics-section">
        <div class="statistics-header" onclick="toggleSection(this)">
          Cartões por Jogador
        </div>
        <div class="statistics-content">
          <table class="statistics-table">
            <thead>
              <tr>
                <th>Time</th>
                <th>Jogador</th>
                <th>Cartões Amarelos</th>
                <th>Cartões Vermelhos</th>
              </tr>
            </thead>
            <tbody>
              ${Object.entries(playerCards).map(([team, players]) => players.map(player => `
                    <tr>
                      <td>${team}</td>
                      <td>${player.name}</td>
                      <td>${player.yellowCards}</td>
                      <td>${player.redCards}</td>
                    </tr>
                  `).join('')).join('')}
            </tbody>
          </table>
        </div>
      </div>
    `;
  }
}
function updateTopScorer(team, field, value) {
  if (field === 'goals') {
    value = parseInt(value) || 0;
  }
  topScorers[team][field] = value;
  localStorage.setItem('topScorers', JSON.stringify(topScorers));
  showSaveFeedback();
}
function displayTeamRosters() {
  const teamsDiv = document.querySelector('#admin-teams .teams-admin');
  let html = '';
  teams.forEach(team => {
    html += `
      <div class="team-roster">
        <h3>${team}</h3>
        <table class="roster-table">
          <thead>
            <tr>
              <th>Número</th>
              <th>Nome do Atleta</th>
              <th>Posição</th>
              <th>Senha</th>
            </tr>
          </thead>
          <tbody>
            ${teamRosters[team].map((player, index) => `
              <tr>
                <td>
                  <input type="number" 
                         min="1" 
                         max="99" 
                         value="${player.number}"
                         onchange="updateRoster('${team}', ${index}, 'number', this.value)">
                </td>
                <td>
                  <input type="text" 
                         value="${player.name}"
                         onchange="updateRoster('${team}', ${index}, 'name', this.value)">
                </td>
                <td>
                  <input type="text"
                         value="${player.position}"
                         onchange="updateRoster('${team}', ${index}, 'position', this.value)"
                         placeholder="Posição">
                </td>
                <td>
                  <input type="text"
                         class="password-input" 
                         maxlength="4"
                         pattern="[0-9]{4}"
                         value="${player.password}"
                         onchange="updateRoster('${team}', ${index}, 'password', this.value)"
                         placeholder="4 dígitos">
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      </div>
    `;
  });
  teamsDiv.innerHTML = html;
}
function updateRoster(team, index, field, value) {
  if (field === 'number') {
    value = parseInt(value) || '';
  }
  if (field === 'password') {
    value = value.replace(/[^0-9]/g, '').slice(0, 4);
  }
  teamRosters[team][index][field] = value;
  localStorage.setItem('teamRosters', JSON.stringify(teamRosters));
  if (field === 'number') {
    playerVotingPassword[value] = teamRosters[team][index].number;
  }
  showSaveFeedback();
}
function displayPublicTeamRosters() {
  const teamsDiv = document.getElementById('teams');
  let html = '<h2>Times</h2>';
  teams.forEach(team => {
    html += `
      <div class="team-roster">
        <h3>${team}</h3>
        <table class="roster-table">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Número</th>
              <th>Posição</th>
            </tr>
          </thead>
          <tbody>
            ${teamRosters[team].filter(player => player.name).map(player => `
                <tr>
                  <td>${player.name}</td>
                  <td>${player.number || ''}</td>
                  <td>${player.position || ''}</td>
                </tr>
              `).join('')}
          </tbody>
        </table>
      </div>
    `;
  });
  teamsDiv.innerHTML = html;
}
function updatePlayerCards(team, index, field, value) {
  if (field === 'yellowCards' || field === 'redCards') {
    value = parseInt(value) || 0;
  }
  playerCards[team][index][field] = value;
  localStorage.setItem('playerCards', JSON.stringify(playerCards));
  showSaveFeedback();
}
function toggleSection(header) {
  header.classList.toggle('collapsed');
  header.nextElementSibling.classList.toggle('collapsed');
}
window.onload = function () {
  initializeTeams();
  const savedMatches = localStorage.getItem('matches');
  if (savedMatches) {
    matches = JSON.parse(savedMatches);
  } else {
    generateMatches();
  }
  showTab('classification');
  if (currentTab === 'admin') {
    showAdminTab(currentAdminTab);
  }
  updateStandings();
  displayMatches();
  const savedWaitingList = localStorage.getItem('waitingList');
  if (savedWaitingList) {
    waitingList = JSON.parse(savedWaitingList);
  }
  const savedLicenses = localStorage.getItem('licenses');
  if (savedLicenses) {
    licenses = JSON.parse(savedLicenses);
  }
  const savedWaitingListAgain = localStorage.getItem('waitingList');
  if (savedWaitingListAgain) {
    waitingList = JSON.parse(savedWaitingListAgain);
    updateWaitingListTable();
    displayPublicWaitingList();
  }
  if (currentTab === 'waiting-list') {
    displayPublicWaitingList();
  }
  if (currentTab === 'licenses') {
    displayPublicLicenses();
  }
  if (localStorage.getItem('statuteContent')) {
    statuteContent = localStorage.getItem('statuteContent');
    document.getElementById('statute-display').innerHTML = statuteContent.replace(/\n/g, '<br>');
    if (document.getElementById('admin-statute-text')) {
      document.getElementById('admin-statute-text').value = statuteContent;
    }
  }
  const savedTopScorers = localStorage.getItem('topScorers');
  if (savedTopScorers) {
    topScorers = JSON.parse(savedTopScorers);
  }
  const savedRosters = localStorage.getItem('teamRosters');
  if (savedRosters) {
    teamRosters = JSON.parse(savedRosters);
  }
  const savedPollVotes = localStorage.getItem('pollVotes');
  if (savedPollVotes) {
    pollVotes = JSON.parse(savedPollVotes);
  }
  const savedVotingStatus = localStorage.getItem('isVotingEnabled');
  if (savedVotingStatus !== null) {
    isVotingEnabled = JSON.parse(savedVotingStatus);
  }
  const savedHasVoted = localStorage.getItem('hasVoted');
  if (savedHasVoted) {
    hasVoted = new Set(JSON.parse(savedHasVoted));
  }
  if (currentTab === 'poll') {
    displayPublicPoll();
  }
  const savedPlayerCards = localStorage.getItem('playerCards');
  if (savedPlayerCards) {
    playerCards = JSON.parse(savedPlayerCards);
  }
};
function displayPollAdmin() {
  const pollDiv = document.querySelector('#admin-poll .poll-admin');
  let html = `
      <div class="poll-controls">
          <button class="poll-button" onclick="toggleVoting()">${isVotingEnabled ? 'Encerrar Votação' : 'Iniciar Votação'}</button>
          <button class="poll-button" onclick="resetPoll()">Reiniciar Votação</button>
      </div>
      <div class="poll-results">
          <h4>Resultados</h4>
          <table class="poll-results-table">
              <thead>
                  <tr>
                      <th>Time</th>
                      <th>Jogador</th>
                      <th>Votos</th>
                  </tr>
              </thead>
              <tbody>
                  ${getPollResults()}
              </tbody>
          </table>
      </div>
  `;
  html += `
      <div class="poll-voting-controls">
          <h4>Configurações de Votação</h4>
          <button class="poll-button" onclick="resetPlayerVotes()">Resetar Votos dos Jogadores</button>
      </div>
  `;
  pollDiv.innerHTML = html;
}
function updatePlayersList() {
  const team = document.getElementById('poll-team').value;
  const playerSelect = document.getElementById('poll-player');
  if (!team) {
    playerSelect.innerHTML = '<option value="">Selecione o Jogador</option>';
    return;
  }
  playerSelect.innerHTML = `
      <option value="">Selecione o Jogador</option>
      ${teamRosters[team].filter(player => player.name).map(player => `<option value="${player.name}">${player.name}</option>`).join('')}
  `;
}
function getPollResults() {
  const results = {};
  pollVotes.forEach(vote => {
    const key = `${vote.team}-${vote.player}`;
    results[key] = results[key] || {
      team: vote.team,
      player: vote.player,
      votes: 0
    };
    results[key].votes++;
  });
  const sortedResults = Object.values(results).sort((a, b) => b.votes - a.votes);
  if (currentTab === 'admin') {
    return sortedResults.map(result => `
      <tr>
        <td>${result.team}</td>
        <td>${result.player}</td>
        <td>${result.votes}</td>
      </tr>
    `).join('');
  } else {
    return sortedResults.map(result => `
      <tr>
        <td>${result.team}</td>
        <td>${result.player}</td>
        <td>-</td>
      </tr>
    `).join('');
  }
}
function toggleVoting() {
  isVotingEnabled = !isVotingEnabled;
  localStorage.setItem('isVotingEnabled', isVotingEnabled);
  displayPollAdmin();
  displayPublicPoll();
  showSaveFeedback();
}
function resetPoll() {
  if (confirm('Tem certeza que deseja reiniciar a votação? Todos os votos serão apagados.')) {
    pollVotes = [];
    localStorage.setItem('pollVotes', JSON.stringify(pollVotes));
    displayPollAdmin();
    showSaveFeedback();
  }
}
function displayPublicPoll() {
  const pollDiv = document.querySelector('#poll');
  if (!isVotingEnabled) {
    const results = {};
    pollVotes.forEach(vote => {
      const key = `${vote.team}-${vote.player}`;
      results[key] = results[key] || {
        team: vote.team,
        player: vote.player,
        votes: 0
      };
      results[key].votes++;
    });
    const sortedResults = Object.values(results).sort((a, b) => b.votes - a.votes);
    const mostVotedHtml = !isVotingEnabled && sortedResults[0] ? `
      <div class="most-voted-player">
        <h3>Jogador Mais Votado</h3>
        <p>${sortedResults[0].player} (${sortedResults[0].team})</p>
      </div>
    ` : '';
    pollDiv.innerHTML = `
      <h2>Enquete - Melhor Jogador</h2>
      ${mostVotedHtml}
      <p>Votação encerrada no momento.</p>
    `;
    return;
  }
  const results = {};
  pollVotes.forEach(vote => {
    const key = `${vote.team}-${vote.player}`;
    results[key] = results[key] || {
      team: vote.team,
      player: vote.player,
      votes: 0
    };
    results[key].votes++;
  });
  const sortedResults = Object.values(results).sort((a, b) => b.votes - a.votes);
  const mostVotedHtml = !isVotingEnabled && sortedResults[0] ? `
    <div class="most-voted-player">
      <h3>Jogador Mais Votado</h3>
      <p>${sortedResults[0].player} (${sortedResults[0].team})</p>
    </div>
  ` : '';
  pollDiv.innerHTML = `
        <h2>Enquete - Melhor Jogador</h2>
        ${mostVotedHtml}
        <div class="poll-login-form">
            <h4>Login para Votação</h4>
            <input type="text" id="player-name" placeholder="Seu nome">
            <input type="number" id="player-number" placeholder="Número da camisa">
            <button class="poll-button" onclick="playerLogin()">Entrar</button>
        </div>
        <div id="vote-form" style="display: none;">
            <div class="poll-form">
                <select id="poll-team-public" onchange="updatePlayersListPublic()">
                    <option value="">Selecione o Time</option>
                    ${teams.map(team => `<option value="${team}">${team}</option>`).join('')}
                </select>
                <select id="poll-player-public">
                    <option value="">Selecione o Jogador</option>
                </select>
                <button class="poll-button" onclick="submitPlayerVote()">Votar</button>
            </div>
            <div id="vote-feedback" class="vote-feedback"></div>
        </div>
        <div class="poll-results-public">
            <h4>Resultados Parciais</h4>
            <table class="poll-results-table">
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Jogador</th>
                        <th>Votos</th>
                    </tr>
                </thead>
                <tbody>
                    ${getPollResults()}
                </tbody>
            </table>
        </div>
    `;
}
function playerLogin() {
  const name = document.getElementById('player-name').value;
  const number = document.getElementById('player-number').value;
  if (hasVoted.has(name)) {
    alert('Você já votou!');
    return;
  }
  let found = false;
  for (const team in teamRosters) {
    const player = teamRosters[team].find(p => p.name === name && p.password === number);
    if (player) {
      found = true;
      break;
    }
  }
  if (found) {
    document.querySelector('.poll-login-form').style.display = 'none';
    document.getElementById('vote-form').style.display = 'block';
  } else {
    alert('Nome ou senha incorretos!');
  }
}
function updatePlayersListPublic() {
  const team = document.getElementById('poll-team-public').value;
  const playerSelect = document.getElementById('poll-player-public');
  if (!team) {
    playerSelect.innerHTML = '<option value="">Selecione o Jogador</option>';
    return;
  }
  playerSelect.innerHTML = `
    <option value="">Selecione o Jogador</option>
    ${teamRosters[team].filter(player => player.name).map(player => `<option value="${player.name}">${player.name}</option>`).join('')}
  `;
}
function submitPlayerVote() {
  const team = document.getElementById('poll-team-public').value;
  const player = document.getElementById('poll-player-public').value;
  const voterName = document.getElementById('player-name').value;
  if (!team || !player) {
    alert('Por favor, selecione um time e um jogador!');
    return;
  }
  pollVotes.push({
    team,
    player
  });
  hasVoted.add(voterName);
  localStorage.setItem('pollVotes', JSON.stringify(pollVotes));
  localStorage.setItem('hasVoted', JSON.stringify([...hasVoted]));
  const feedback = document.getElementById('vote-feedback');
  feedback.textContent = 'Voto registrado com sucesso!';
  feedback.style.display = 'block';
  setTimeout(() => {
    feedback.style.display = 'none';
    displayPublicPoll();
  }, 2000);
}
function resetPlayerVotes() {
  if (confirm('Tem certeza que deseja resetar todos os votos dos jogadores?')) {
    hasVoted.clear();
    localStorage.setItem('hasVoted', JSON.stringify([]));
    showSaveFeedback();
  }
}
</script>
</head>
<body>
    <div class="container">
        <h1>VETERANOS GRÊMIO MINEIRO</h1>

        <div class="tabs">
            <button class="tab" onclick="showTab('classification')">Tab Classificação</button>
            <button class="tab" onclick="showTab('matches')">Confrontos</button>
            <button class="tab" onclick="showTab('statute')">Estatuto</button>
            <button class="tab" onclick="showTab('waiting-list')">Lista de Espera</button>
            <button class="tab" onclick="showTab('licenses')">Joga. Licenças</button>
            <button class="tab" onclick="showTab('statistics')">Desempenho/Probabilidade</button>
            <button class="tab" onclick="showTab('poll')">Enquete</button>
            <button class="tab" onclick="showTab('admin')">Administrador</button>
            <button class="tab" onclick="showTab('teams')">Times</button>
        </div>

        <div id="classification" class="tab-content">
            <h2>Tab Classificação</h2>
            <table id="standings-table"></table>
        </div>

        <div id="matches" class="tab-content" style="display: none;">
            <h2>Confrontos</h2>
            <div class="matches"></div>
        </div>

        <div id="statute" class="tab-content" style="display: none;">
            <h2>Estatuto</h2>
            <div id="statute-content">
                <div class="statute-controls">
                    <button class="statute-button download-button" onclick="downloadStatute()">Baixar PDF</button>
                </div>
                <div id="statute-display"></div>
            </div>
        </div>

        <div id="waiting-list" class="tab-content" style="display: none;">
            <h2>Lista de Espera</h2>
        </div>

        <div id="licenses" class="tab-content" style="display: none;">
            <h2>Joga. Licenças</h2>
            <div class="licenses-display">
                <table class="licenses-table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Time</th>
                            <th>Início</th>
                            <th>Fim</th>
                        </tr>
                    </thead>
                    <tbody id="public-licenses-tbody">
                    </tbody>
                </table>
            </div>
        </div>

        <div id="statistics" class="tab-content" style="display: none;">
            <h2>Desempenho/Probabilidade</h2>
        </div>

        <div id="poll" class="tab-content" style="display: none;">
            <h2>Enquete - Melhor Jogador</h2>
            <div class="poll-login-form">
                <h4>Login para Votação</h4>
                <input type="text" id="player-name" placeholder="Seu nome">
                <input type="password" id="player-number" placeholder="Senha" maxlength="4">
                <button class="poll-button" onclick="playerLogin()">Entrar</button>
            </div>
            <div class="poll-results">
                <table class="poll-results-table">
                  <thead>
                    <tr>
                      <th>Time</th>
                      <th>Jogador</th>
                      <th>Posição</th>
                    </tr>
                  </thead>
                  <tbody>
                    ${getPollResults()}
                  </tbody>
                </table>
            </div>
        </div>

        <div id="admin" class="tab-content" style="display: none;">
            <div id="admin-login-form" class="admin-login">
                <h2>Login Administrador</h2>
                <div class="form-group">
                    <label for="admin-password">Senha:</label>
                    <input type="password" id="admin-password" class="password-input">
                </div>
                <button onclick="adminLogin()">Entrar</button>
            </div>
            <div id="admin-content" style="display: none;">
                <div class="admin-tabs">
                    <button class="admin-tab" onclick="showAdminTab('statute')">Estatuto</button>
                    <button class="admin-tab" data-tab="waitinglist" onclick="showAdminTab('waitinglist')">Lista de Espera</button>
                    <button class="admin-tab" onclick="showAdminTab('licenses')">Joga. Licenças</button>
                    <button class="admin-tab" data-tab="statistics" onclick="showAdminTab('statistics')">Estatísticas</button>
                    <button class="admin-tab" data-tab="poll" onclick="showAdminTab('poll')">Enquete</button>
                    <button class="admin-tab" data-tab="teams" onclick="showAdminTab('teams')">Times</button>
                </div>
                <div id="admin-statute" class="admin-section">
                    <h3>Gestão do Estatuto</h3>
                    <textarea id="admin-statute-text" placeholder="Digite o estatuto aqui..."></textarea>
                    <div class="admin-statute-controls">
                        <button class="statute-button" onclick="saveAdminStatute()">Salvar Estatuto</button>
                        <button class="statute-button download-button" onclick="downloadAdminStatute()">Baixar PDF</button>
                    </div>
                </div>
                <div id="admin-waiting-list" class="admin-section" style="display: none;">
                    <!-- Admin waiting list content -->
                </div>
                <div id="admin-licenses" class="admin-section" style="display: none;">
                    <!-- Admin licenses content -->
                </div>
                <div id="admin-statistics" class="admin-section" style="display: none;">
                    <h3>Desempenho/Probabilidade</h3>
                    <div class="statistics-admin">
                        <!-- Statistics content will go here -->
                    </div>
                </div>
                <div id="admin-poll" class="admin-section" style="display: none;">
                    <h3>Enquete</h3>
                    <div class="poll-admin">
                        <!-- Poll content will go here -->
                    </div>
                </div>
                <div id="admin-teams" class="admin-section" style="display: none;">
                    <h3>Times</h3>
                    <div class="teams-admin">
                        <!-- Teams content will go here -->
                    </div>
                </div>
            </div>
        </div>

        <div id="teams" class="tab-content" style="display: none;">
          <!-- Content will be populated by displayPublicTeamRosters() -->
        </div>
    </div>
</body>
</html>
